{% extends 'main/base.html' %}

{% block title %}{{ user.username }}'s Profile{% endblock %}

{% block extra_css %}
  

    .profile-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 1rem;
    }
    .profile-header {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
    }
    .stat-card {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
    }
    .metrics-section {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .label {
        color: #6c757d;
        font-size: 0.9rem;
    }
    .value {
        font-size: 1.1rem;
        font-weight: 500;
    }
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }
    .chart-container {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .chart-wrapper {
        height: 300px;
        margin: 1rem 0;
    }
    .no-data-message {
        text-align: center;
        color: #6c757d;
        padding: 2rem;
    }

    
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% for metric_type, data in metrics_data.items %}
        {% if data.has_data %}
        const ctx_{{ metric_type }} = document.getElementById('chart_{{ metric_type }}').getContext('2d');
        new Chart(ctx_{{ metric_type }}, {
            type: 'line',
            data: {
                labels: {{ data.labels|safe }},
                datasets: [{
                    label: '{{ data.display }}',
                    data: {{ data.values|safe }},
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '{{ data.display }} Progress'
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                const label = context[0].label;
                                // Handle both array and string labels
                                if (Array.isArray(label)) {
                                    return label[0]; // Show only date in tooltip title
                                }
                                return label;
                            },
                            afterLabel: function(context) {
                                const label = context.label;
                                // Handle both array and string labels
                                if (Array.isArray(label) && label.length > 1) {
                                    return 'Captured By: ' + label[1];
                                }
                                return '';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        reverse: {{ data.reverse|yesno:"true,false" }},
                        title: {
                            display: true,
                            text: '{{ data.unit }}'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        {% endif %}
    {% endfor %}
});
</script>
{% endblock %}

{% block content %}
<div class="container">
  <div class="row">
    <!-- Column 1: spans all 5 rows -->
    <div class="col-md-4 ">
      <div class="p-3 bg-white border h-100">
        <h1>{{ user.get_full_name|default:user.username }}</h1>
        <img src="{{ profile.picture.url }}" alt="{{ user.username }} picture" style="max-width:150px;border-radius:8px;" />
        
        {% if profile.bio %}
        <div class="bio-section mt-4">
            <hr>
            <p>{{ profile.bio }}</p>
        </div>
        {% endif %}
        <a href="{% url 'edit_profile' %}" class="btn btn-primary">Edit Profile</a>
      </div>
    </div>

    <!-- Columns 2 and 3 split into 5 rows -->
    <div class="col-md-8">
      <div class="row">
        <div class="col-md-6 p-3 bg-white border"><div class="label">Positions</div>
                <div class="value">{{ profile.position|default:"Not set" }}</div></div>
        <div class="col-md-6 p-3 bg-white border"><div class="label">Team</div>
                <div class="value">{{ profile.team|default:"Not set" }}</div></div>

        <div class="col-md-6 p-3 bg-white border"><div class="label">City</div>
                <div class="value">{{ profile.city|default:"Not set" }}</div></div>
        <div class="col-md-6 p-3 bg-white border"><div class="label">State</div>
                <div class="value">{% if profile.state %}{{ profile.get_state_display }}{% else %}Not set{% endif %}</div></div>

        <div class="col-md-6 p-3 bg-white border"><div class="label">Height</div>
                <div class="value">
                    {% if profile.height_inches %}
                        {{ profile.height_inches }} inches
                    {% else %}
                        Not set
                    {% endif %}
                </div></div>
        <div class="col-md-6 p-3 bg-white border"><div class="label">Weight</div>
                <div class="value">
                    {% if profile.weight_lbs %}
                        {{ profile.weight_lbs }} lbs
                    {% else %}
                        Not set
                    {% endif %}
                </div></div>

    <div class="col-md-6 p-3 bg-white border"><div class="label">Graduation Year</div>
        <div class="value">{{ profile.graduation_year|default:"Not set" }}</div></div>
    <div class="col-md-6 p-3 bg-white border"><div class="label">School</div>
        <div class="value">{{ profile.school|default:"Not set" }}</div></div>

    <div class="col-md-6 p-3 bg-white border"><div class="label">Throws</div>
        <div class="value">{% if profile.throws %}{{ profile.get_throws_display }}{% else %}Not set{% endif %}</div></div>
    <div class="col-md-6 p-3 bg-white border"><div class="label">Hits</div>
        <div class="value">{% if profile.hits %}{{ profile.get_hits_display }}{% else %}Not set{% endif %}</div></div>
      </div>
    </div>
  </div>
</div>








    

    


    <div class="charts-grid">
        {% for metric_type, data in metrics_data.items %}
            <div class="chart-container">
                <h3>{{ data.display }}</h3>
                {% if data.has_data %}
                    <div class="chart-wrapper">
                        <canvas id="chart_{{ metric_type }}"></canvas>
                    </div>
                {% else %}
                    <div class="no-data-message">
                        No {{ data.display|lower }} metrics recorded yet
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

{% endblock %}
