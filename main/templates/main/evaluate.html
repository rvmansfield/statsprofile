{% extends 'main/base.html' %}

{% block title %}Stats Profile{% endblock %}

{% block extra_css %}
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        .form-title {
            text-align: center;
            color: #333;
            margin-bottom: 2rem;
            font-weight: 600;
        }
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        .btn-submit {
            background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.4);
        }
        
        /* Validation styling */
        .form-control.is-valid {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }
        
        .form-control.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .numeric-hint {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
{% endblock %}

{% block content %}
    <div class="form-container">
        <h2 class="form-title">Player Evaluation</h2>
        
        {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        
        <form method="post" action="{% url 'evaluate' %}">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="{{ form.metricType.id_for_label }}" class="form-label">Metric Type</label>
                {{ form.metricType }}
                {% if form.metricType.errors %}
                    <div class="text-danger">{{ form.metricType.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.metric.id_for_label }}" class="form-label">Metric</label>
                {{ form.metric }}
                <div class="numeric-hint">Enter a numeric value (e.g., 85.5 for velocity, 6.8 for dash time)</div>
                {% if form.metric.errors %}
                    <div class="text-danger">{{ form.metric.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.playerAge.id_for_label }}" class="form-label">Player Age</label>
                {{ form.playerAge }}
                <div class="numeric-hint">Select your age (12-20)</div>
                {% if form.playerAge.errors %}
                    <div class="text-danger">{{ form.playerAge.errors }}</div>
                {% endif %}
            </div>
            
            <div class="d-grid">
                <button type="submit" class="btn btn-submit">Submit</button>
            </div>
        </form>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        function validateNumeric(input) {
            // Remove any non-numeric characters except decimal point
            let value = input.value.replace(/[^0-9.]/g, '');
            
            
            // Ensure only one decimal point
            let parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Update the input value
            input.value = value;
            
            // Add visual feedback
            if (value === '' || isNaN(value)) {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
            } else {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
            }
        }
        
        // Add form validation on submit
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            if (!form) {
                console.error('Form not found');
                return;
            }
            
            form.addEventListener('submit', function(e) {
                let hasErrors = false;
                const errorMessages = [];
                
                const metricTypeInput = document.getElementById('{{ form.metricType.id_for_label }}');
                const metricInput = document.getElementById('{{ form.metric.id_for_label }}');
                const ageInput = document.getElementById('{{ form.playerAge.id_for_label }}');
                
                // Clear previous error states
                if (metricTypeInput) metricTypeInput.classList.remove('is-invalid');
                if (metricInput) metricInput.classList.remove('is-invalid');
                if (ageInput) ageInput.classList.remove('is-invalid');
                
                // Validate metricType field
                if (!metricTypeInput || !metricTypeInput.value || metricTypeInput.value === '') {
                    e.preventDefault();
                    hasErrors = true;
                    if (metricTypeInput) {
                        metricTypeInput.classList.add('is-invalid');
                    }
                    errorMessages.push('Please select a metric type.');
                }
                
                // Validate metric field
                if (!metricInput || metricInput.value === '' || isNaN(metricInput.value) || parseFloat(metricInput.value) < 0) {
                    e.preventDefault();
                    hasErrors = true;
                    if (metricInput) {
                        metricInput.classList.add('is-invalid');
                    }
                    errorMessages.push('Please enter a valid numeric value for the metric.');
                }
                
                // Validate age field (must be selected)
                if (!ageInput || !ageInput.value || ageInput.value === '') {
                    e.preventDefault();
                    hasErrors = true;
                    if (ageInput) {
                        ageInput.classList.add('is-invalid');
                    }
                    errorMessages.push('Please select an age between 12 and 20.');
                }
                
                if (hasErrors) {
                    alert('Please correct the following errors:\n\n' + errorMessages.join('\n'));
                    return false;
                }
                
                // If validation passes, allow form to submit
                console.log('Form validation passed, submitting...');
            });
        });
    </script>
{% endblock %}
